<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>SocketIO Client</title>
  <script src="/socket.io/socket.io.js"></script>
  <link rel="stylesheet" type="text/css" href="index.css">
</head>

<body>
  <div id="arrow"></div>
  <div id="acc"></div>

  <div>
    <button>Save</button>
    <button>btn2</button>
  </div>

  <!-- <canvas id="gl" width="640" height="480"></canvas> -->
  <div>
    <button id='red' onClick='changeColor(this.id)'></button>
  </div>
  <div>
    <button id='yellow' onClick="changeColor(this.id)"></button>
  </div>
  <div>
    <button id='blue' onClick="changeColor(this.id)"></button>
  </div>


  <!-- Client Code -->
  <script type="text/javascript">
    // Get WebSocket
    var socket = io();
    // Get DOM elements
    var arrow = document.getElementById("arrow");
    var a, b, c;
    var a5 = 0, b5 = 0, c5 = 0, times = 0,  color="red";
    
    // add accel variable
    var accX;


    window.addEventListener("deviceorientation", orientationHandler, false);
    function orientationHandler(event) {
      text = "";
      a = event.alpha;
      b = event.beta;
      c = event.gamma;
      // accX = event.acceleration.x;

      a5+=a;
      b5+=b;
      c5+=c;
      times += 1.0;
      text += "左右旋转：rotate alpha{" + a + "deg)<p>";
      text += "前后旋转：rotate beta{" + b + "deg)<p>";
      text += "扭转设备：rotate gamma{" + c + "deg)<p>";
      arrow.innerHTML = text;

       if(times > 7.0){
        socket.emit('listener', {id: socket.id,
          alpha: Math.round(a5/times), 
          beta: Math.round(b5/ times),
          gamma: Math.round(c5/times),
          accX: Math.round(accX),
          color: color,

      });
        a5 = b5 = c5 = times = 0;
      }

    }

    var sumAccX = 0;
    var t = 0;

    window.addEventListener("devicemotion", motionHandler, false);
    function motionHandler(event){
      accX = event.acceleration.x;
      acc.innerHTML = accX + "m/s2";

      // sumAccX += accX;
      // t += 1.0;

      // if(t > 7.0){
      //   socket.emit('listener',{
      //     id: socket.id,
      //     accX: Math.round(accX/t),
      //   });
      //   sumAccX = t = 0;
      // }
    }


    function changeColor(id){
      color = id; 

    }
  </script>
</body>

</html>